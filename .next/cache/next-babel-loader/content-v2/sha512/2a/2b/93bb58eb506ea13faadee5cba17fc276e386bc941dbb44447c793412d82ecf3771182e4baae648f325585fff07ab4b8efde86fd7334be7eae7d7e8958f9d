{"ast":null,"code":"import cheerio from \"cheerio\";\nconst groupClass = \"gallery\"; // Wraps the element <figure> with a div only if <figure> has more siblings\n\n/*\n  <p></p>\n  <figure>..</figure>\n  <figure></figure>\n  <p></p>\n  <figure></figure>\n\n  The above markup will be converted to \n\n  <p></p>\n  <div class=\"gallery\">\n    <figure>..</figure>\n    <figure></figure>\n  </div>\n  <p></p>\n  <figure></figure>\n*/\n\nexport const addGalleryWrapper = (htmlStr, selector = \"figure\") => {\n  const $ = cheerio.load(htmlStr.replace(/\\n/, \"\"));\n  let participants = $(selector);\n  participants.each((_i, current) => {\n    const nextInSource = $(current).next(selector);\n    const prevInSource = $(current).prev();\n    const nextInSourceIsSibling = nextInSource.length !== 0;\n    const hasGroup = prevInSource && $(prevInSource).attr(\"class\") === groupClass;\n    const isSingle = !hasGroup && !nextInSourceIsSibling;\n    if (isSingle) return;\n\n    if (!hasGroup) {\n      const group = $('<div class=\"' + groupClass + '\"></div>');\n      $(current).wrap(group);\n    } else if (prevInSource) {\n      $(prevInSource).append(current);\n    }\n  });\n  return $.html();\n};","map":{"version":3,"sources":["/Users/abhi/www/letterpad-admin/src/graphql/utils/addGalleryWrappr.ts"],"names":["cheerio","groupClass","addGalleryWrapper","htmlStr","selector","$","load","replace","participants","each","_i","current","nextInSource","next","prevInSource","prev","nextInSourceIsSibling","length","hasGroup","attr","isSingle","group","wrap","append","html"],"mappings":"AAAA,OAAOA,OAAP,MAAoB,SAApB;AAEA,MAAMC,UAAU,GAAG,SAAnB,C,CAEA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,MAAMC,iBAAiB,GAAG,CAC/BC,OAD+B,EAE/BC,QAAgB,GAAG,QAFY,KAG5B;AACH,QAAMC,CAAC,GAAGL,OAAO,CAACM,IAAR,CAAaH,OAAO,CAACI,OAAR,CAAgB,IAAhB,EAAsB,EAAtB,CAAb,CAAV;AAEA,MAAIC,YAAY,GAAGH,CAAC,CAACD,QAAD,CAApB;AAEAI,EAAAA,YAAY,CAACC,IAAb,CAAkB,CAACC,EAAD,EAAKC,OAAL,KAAiB;AACjC,UAAMC,YAAY,GAAGP,CAAC,CAACM,OAAD,CAAD,CAAWE,IAAX,CAAgBT,QAAhB,CAArB;AACA,UAAMU,YAAY,GAAGT,CAAC,CAACM,OAAD,CAAD,CAAWI,IAAX,EAArB;AAEA,UAAMC,qBAAqB,GAAGJ,YAAY,CAACK,MAAb,KAAwB,CAAtD;AACA,UAAMC,QAAQ,GACZJ,YAAY,IAAIT,CAAC,CAACS,YAAD,CAAD,CAAgBK,IAAhB,CAAqB,OAArB,MAAkClB,UADpD;AAGA,UAAMmB,QAAQ,GAAG,CAACF,QAAD,IAAa,CAACF,qBAA/B;AAEA,QAAII,QAAJ,EAAc;;AAEd,QAAI,CAACF,QAAL,EAAe;AACb,YAAMG,KAAK,GAAGhB,CAAC,CAAC,iBAAiBJ,UAAjB,GAA8B,UAA/B,CAAf;AACAI,MAAAA,CAAC,CAACM,OAAD,CAAD,CAAWW,IAAX,CAAgBD,KAAhB;AACD,KAHD,MAGO,IAAIP,YAAJ,EAAkB;AACvBT,MAAAA,CAAC,CAACS,YAAD,CAAD,CAAgBS,MAAhB,CAAuBZ,OAAvB;AACD;AACF,GAlBD;AAmBA,SAAON,CAAC,CAACmB,IAAF,EAAP;AACD,CA5BM","sourcesContent":["import cheerio from \"cheerio\";\n\nconst groupClass = \"gallery\";\n\n// Wraps the element <figure> with a div only if <figure> has more siblings\n/*\n  <p></p>\n  <figure>..</figure>\n  <figure></figure>\n  <p></p>\n  <figure></figure>\n\n  The above markup will be converted to \n\n  <p></p>\n  <div class=\"gallery\">\n    <figure>..</figure>\n    <figure></figure>\n  </div>\n  <p></p>\n  <figure></figure>\n*/\nexport const addGalleryWrapper = (\n  htmlStr: string,\n  selector: string = \"figure\",\n) => {\n  const $ = cheerio.load(htmlStr.replace(/\\n/, \"\"));\n\n  let participants = $(selector);\n\n  participants.each((_i, current) => {\n    const nextInSource = $(current).next(selector);\n    const prevInSource = $(current).prev();\n\n    const nextInSourceIsSibling = nextInSource.length !== 0;\n    const hasGroup =\n      prevInSource && $(prevInSource).attr(\"class\") === groupClass;\n\n    const isSingle = !hasGroup && !nextInSourceIsSibling;\n\n    if (isSingle) return;\n\n    if (!hasGroup) {\n      const group = $('<div class=\"' + groupClass + '\"></div>');\n      $(current).wrap(group);\n    } else if (prevInSource) {\n      $(prevInSource).append(current);\n    }\n  });\n  return $.html();\n};\n"]},"metadata":{},"sourceType":"module"}