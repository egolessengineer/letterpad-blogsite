{"ast":null,"code":"import _defineProperty from \"/Users/abhi/www/letterpad-admin/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"/Users/abhi/www/letterpad-admin/node_modules/next/node_modules/@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"/Users/abhi/www/letterpad-admin/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/abhi/www/letterpad-admin/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/abhi/www/letterpad-admin/src/pages/_app.tsx\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useApollo } from \"@/graphql/apollo\";\nimport { Provider } from \"next-auth/client\";\nimport { useRouter } from \"next/router\";\nimport nextConfig from \"../../next.config\";\nimport { useEffect, useState } from \"react\";\nimport ThemeSwitcher from \"@/components/layouts/ThemeSwitcher\";\nimport \"lazysizes\";\nimport Main from \"@/components/main\";\nimport { getSettings, initPageProgress } from \"../../shared/utils\";\nimport dynamic from \"next/dynamic\";\nimport \"../../styles/globals.css\";\n\nfunction App(_ref) {\n  _s();\n\n  var Component = _ref.Component,\n      pageProps = _ref.pageProps;\n  var apolloClientPromise = useApollo(pageProps.initialApolloState);\n\n  var _useState = useState(null),\n      settings = _useState[0],\n      setSettings = _useState[1];\n\n  var _useState2 = useState(),\n      apolloClient = _useState2[0],\n      setClient = _useState2[1];\n\n  var router = useRouter();\n  var ComponentRequiresAuth = Component.needsAuth;\n  useEffect(function () {\n    if (ComponentRequiresAuth) {\n      var init = /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n          var _data$settings;\n\n          var client, _yield$getSettings, data;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return apolloClientPromise;\n\n                case 2:\n                  client = _context.sent;\n                  setClient(client);\n                  _context.next = 6;\n                  return getSettings();\n\n                case 6:\n                  _yield$getSettings = _context.sent;\n                  data = _yield$getSettings.data;\n\n                  if (!(((_data$settings = data.settings) === null || _data$settings === void 0 ? void 0 : _data$settings.__typename) === \"Setting\")) {\n                    _context.next = 10;\n                    break;\n                  }\n\n                  return _context.abrupt(\"return\", setSettings(data.settings));\n\n                case 10:\n                  router.push(\"/api/auth/signin\");\n\n                case 11:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function init() {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n\n      ThemeSwitcher[\"switch\"](localStorage.theme);\n      initPageProgress();\n      init();\n    }\n  }, []);\n\n  if (!ComponentRequiresAuth) {\n    return __jsx(Provider, {\n      session: pageProps.session,\n      options: {\n        basePath: nextConfig.basePath + \"/api/auth\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 7\n      }\n    }, __jsx(Component, _extends({}, pageProps, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 56,\n        columnNumber: 9\n      }\n    })));\n  }\n\n  var Layout = Component.layout || NoLayout;\n  if (!apolloClient || !settings) return null;\n  return __jsx(Main, {\n    apolloClient: apolloClient,\n    Component: Component,\n    Layout: Layout,\n    props: _objectSpread({}, pageProps),\n    settings: settings,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 5\n    }\n  });\n}\n\n_s(App, \"eReOMmSwoUWO6zCX5esC59bB/gI=\", false, function () {\n  return [useApollo, useRouter];\n});\n\n_c = App;\n\nfunction NoLayout(_ref3) {\n  var children = _ref3.children;\n  return __jsx(React.Fragment, null, children);\n}\n\n_c2 = NoLayout;\nexport default _c4 = dynamic(_c3 = function _c3() {\n  return Promise.resolve(App);\n}, {\n  ssr: false\n});\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"App\");\n$RefreshReg$(_c2, \"NoLayout\");\n$RefreshReg$(_c3, \"%default%$dynamic\");\n$RefreshReg$(_c4, \"%default%\");","map":{"version":3,"sources":["/Users/abhi/www/letterpad-admin/src/pages/_app.tsx"],"names":["useApollo","Provider","useRouter","nextConfig","useEffect","useState","ThemeSwitcher","Main","getSettings","initPageProgress","dynamic","App","Component","pageProps","apolloClientPromise","initialApolloState","settings","setSettings","apolloClient","setClient","router","ComponentRequiresAuth","needsAuth","init","client","data","__typename","push","localStorage","theme","session","basePath","Layout","layout","NoLayout","children","Promise","resolve","ssr"],"mappings":"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","sourcesContent":["import { AppProps } from \"next/app\";\nimport { ApolloClient, NormalizedCacheObject } from \"@apollo/client\";\nimport { useApollo } from \"@/graphql/apollo\";\nimport { Provider } from \"next-auth/client\";\nimport { useRouter } from \"next/router\";\nimport nextConfig from \"../../next.config\";\nimport type { Page } from \"../page\";\nimport { PropsWithChildren, useEffect, useState } from \"react\";\nimport { Setting } from \"@/__generated__/queries/queries.graphql\";\nimport ThemeSwitcher from \"@/components/layouts/ThemeSwitcher\";\nimport \"lazysizes\";\nimport Main from \"@/components/main\";\nimport { getSettings, initPageProgress } from \"../../shared/utils\";\nimport dynamic from \"next/dynamic\";\n\nimport \"../../styles/globals.css\";\n\ntype Props = AppProps & {\n  Component: Page;\n};\n\nfunction App({ Component, pageProps }: Props) {\n  const apolloClientPromise = useApollo(pageProps.initialApolloState);\n  const [settings, setSettings] = useState<null | Setting>(null);\n  const [apolloClient, setClient] =\n    useState<ApolloClient<NormalizedCacheObject>>();\n  const router = useRouter();\n\n  const ComponentRequiresAuth = Component.needsAuth;\n\n  useEffect(() => {\n    if (ComponentRequiresAuth) {\n      ThemeSwitcher.switch(localStorage.theme);\n      initPageProgress();\n\n      async function init() {\n        const client = await apolloClientPromise;\n        setClient(client);\n\n        const { data } = await getSettings();\n        if (data.settings?.__typename === \"Setting\") {\n          return setSettings(data.settings);\n        }\n        router.push(\"/api/auth/signin\");\n      }\n      init();\n    }\n  }, []);\n\n  if (!ComponentRequiresAuth) {\n    return (\n      <Provider\n        session={pageProps.session}\n        options={{ basePath: nextConfig.basePath + \"/api/auth\" }}\n      >\n        <Component {...pageProps} />\n      </Provider>\n    );\n  }\n\n  const Layout = Component.layout || NoLayout;\n\n  if (!apolloClient || !settings) return null;\n\n  return (\n    <Main\n      apolloClient={apolloClient}\n      Component={Component}\n      Layout={Layout}\n      props={{ ...pageProps }}\n      settings={settings}\n    />\n  );\n}\n\nfunction NoLayout({ children }: PropsWithChildren<{ settings: Setting }>) {\n  return <>{children}</>;\n}\n\nexport default dynamic(() => Promise.resolve(App), {\n  ssr: false,\n});\n"]},"metadata":{},"sourceType":"module"}