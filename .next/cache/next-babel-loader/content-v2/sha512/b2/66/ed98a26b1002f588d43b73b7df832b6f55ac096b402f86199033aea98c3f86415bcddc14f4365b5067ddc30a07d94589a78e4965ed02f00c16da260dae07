{"ast":null,"code":"import _regeneratorRuntime from \"/Users/abhi/www/letterpad-admin/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"/Users/abhi/www/letterpad-admin/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/Users/abhi/www/letterpad-admin/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/abhi/www/letterpad-admin/src/pages/post/[postId].tsx\",\n    _s = $RefreshSig$(),\n    _this = this;\n\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { PostDocument } from \"@/__generated__/queries/queries.graphql\";\nimport { UpdatePostDocument } from \"@/__generated__/queries/mutations.graphql\";\nimport LetterpadEditor from \"letterpad-editor\";\nimport { initializeApollo } from \"@/graphql/apollo\";\nimport { Input, Layout, PageHeader, Tag, Tooltip } from \"antd\";\nimport { useRouter } from \"next/router\";\nimport Actions from \"@/components/post-meta\";\nimport { PostStatusOptions, PostTypes } from \"@/__generated__/type-defs.graphqls\";\nimport { useEffect, useState } from \"react\";\nimport { uploadFile } from \"../../../shared/upload\";\nimport { removeTypenames } from \"../../../shared/removeTypenames\";\nimport { debounce } from \"../../../shared/utils\";\nimport FileExplorer from \"@/components/file-explorer\";\nimport withAuthCheck from \"../../hoc/withAuth\";\nimport ErrorMessage from \"@/components/ErrorMessage\";\nimport nextConfig from \"next.config\";\nimport { LoadingOutlined } from \"@ant-design/icons\";\nimport Head from \"next/head\";\nvar Content = Layout.Content;\nexport var MediaProvider;\n\n(function (MediaProvider) {\n  MediaProvider[\"Unsplash\"] = \"unsplash\";\n  MediaProvider[\"Letterpad\"] = \"letterpad\";\n})(MediaProvider || (MediaProvider = {}));\n\nvar updatePostRequest = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(attrs, postId) {\n    var apolloClient;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return initializeApollo();\n\n          case 2:\n            apolloClient = _context.sent;\n            return _context.abrupt(\"return\", apolloClient.mutate({\n              mutation: UpdatePostDocument,\n              variables: {\n                data: _objectSpread(_objectSpread({}, removeTypenames(attrs)), {}, {\n                  id: postId\n                })\n              }\n            }));\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function updatePostRequest(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar debounceUpdatePost = debounce(updatePostRequest, 1000);\nvar editor;\n\nfunction Post() {\n  _s();\n\n  var router = useRouter();\n\n  var _useState = useState(false),\n      updating = _useState[0],\n      setUpdating = _useState[1];\n\n  var _useState2 = useState(),\n      post = _useState2[0],\n      setPost = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      error = _useState3[0],\n      setError = _useState3[1];\n\n  var _useState4 = useState(false),\n      fileExplorerOpen = _useState4[0],\n      setFileExplorerOpen = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      postHash = _useState5[0],\n      setPostHash = _useState5[1];\n\n  useEffect(function () {\n    var postId = router.query.postId;\n    if (!postId) return;\n    getPost(parseInt(postId)).then(function (data) {\n      if (data.__typename === \"Post\") {\n        setPost(data);\n        fetch(nextConfig.basePath + \"/api/getPostHash?id=\" + data.id).then(function (res) {\n          return res.text();\n        }).then(setPostHash);\n      }\n\n      if (data.__typename === \"PostError\") {\n        setError(data.message);\n      }\n    });\n  }, [router]);\n\n  if (!post || post.__typename !== \"Post\") {\n    return __jsx(ErrorMessage, {\n      title: \"Error\",\n      description: error,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 12\n      }\n    });\n  }\n\n  var _uploadImage = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(files) {\n      var uploadedFiles;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return uploadFile({\n                files: files,\n                type: \"post_image\"\n              });\n\n            case 2:\n              uploadedFiles = _context2.sent;\n              return _context2.abrupt(\"return\", uploadedFiles[0].src);\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function uploadImage(_x3) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var setPostAttribute = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(attrs) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              // if post is already published and new content is added, then save this as draft\n              if (post.status === PostStatusOptions.Published && attrs.md) {\n                setPost(_objectSpread(_objectSpread({}, post), {}, {\n                  md_draft: attrs.md\n                }));\n              } // if the post is published or republished, remove draft\n              else if (attrs.status === PostStatusOptions.Published) {\n                  setPost(_objectSpread(_objectSpread(_objectSpread({}, post), attrs), {}, {\n                    md_draft: \"\",\n                    md: post.md_draft\n                  }));\n                } // save the other attributes of post\n                else {\n                    setPost(_objectSpread(_objectSpread({}, post), attrs));\n                  }\n\n              setUpdating(true);\n              _context3.next = 4;\n              return debounceUpdatePost(attrs, post.id);\n\n            case 4:\n              setUpdating(false);\n\n            case 5:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function setPostAttribute(_x4) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var onMediaBrowse = function onMediaBrowse() {\n    setFileExplorerOpen(true);\n  };\n\n  var onFileExplorerClose = function onFileExplorerClose() {\n    setFileExplorerOpen(false);\n  };\n\n  var insertImageUrlInEditor = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(images) {\n      var urls, insertPromises;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              urls = Object.keys(images);\n              insertPromises = urls.map(function (url) {\n                return new Promise(function (resolve, reject) {\n                  try {\n                    editor.insertImageUrl(url, images[url].alt || \"\");\n                    resolve(true);\n                  } catch (e) {\n                    reject();\n                    console.error(e);\n                  }\n                });\n              });\n              return _context4.abrupt(\"return\", Promise.all(insertPromises));\n\n            case 3:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function insertImageUrlInEditor(_x5) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var tagColor = post.status === PostStatusOptions.Published ? \"green\" : \"orange\";\n  var isPost = post.type === PostTypes.Post;\n\n  var setRef = function setRef(_editor) {\n    editor = _editor;\n  };\n\n  return __jsx(Layout, {\n    style: {\n      minHeight: \"100vh\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 5\n    }\n  }, __jsx(Head, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 7\n    }\n  }, __jsx(\"title\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 9\n    }\n  }, \"Editing - \", post.title)), __jsx(PageHeader, {\n    className: \"site-page-header\",\n    title: \"\\xA0\",\n    style: {\n      padding: 10\n    },\n    onBack: function onBack() {\n      return router.push(isPost ? \"/posts\" : \"/pages\");\n    },\n    extra: [__jsx(LoadingOutlined, {\n      spin: true,\n      hidden: !updating,\n      key: \"updating\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 11\n      }\n    }), __jsx(Actions, {\n      key: \"actions\",\n      post: post,\n      setPostAttribute: setPostAttribute,\n      postHash: postHash,\n      deletePost: function deletePost() {\n        setPostAttribute({\n          status: PostStatusOptions.Trashed\n        });\n        router.push(isPost ? \"/posts\" : \"/pages\");\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 11\n      }\n    })],\n    tags: __jsx(Tag, {\n      color: tagColor,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 15\n      }\n    }, post.status),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 7\n    }\n  }), __jsx(Content, {\n    style: {\n      margin: \"24px 16px 0\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    style: {\n      maxWidth: 760,\n      margin: \"auto\"\n    },\n    className: \"jsx-2767384027\" + \" \" + \"site-layout-background\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 9\n    }\n  }, __jsx(Input.TextArea, {\n    style: {\n      padding: 0,\n      fontSize: 38,\n      lineHeight: 1,\n      marginBottom: 40\n    },\n    value: post.title,\n    rows: 2,\n    autoSize: true,\n    placeholder: \"Enter a title\",\n    bordered: false,\n    onChange: function onChange(e) {\n      setPostAttribute({\n        title: e.target.value\n      });\n    },\n    onKeyPress: function onKeyPress(e) {\n      if (e.key === \"Enter\") {\n        e.preventDefault();\n        editor.focus();\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 11\n    }\n  }), __jsx(LetterpadEditor, {\n    dark: localStorage.theme === \"dark\",\n    getEditorInstance: setRef,\n    onImageBrowse: onMediaBrowse,\n    uploadImage: function uploadImage(file) {\n      return _uploadImage([file]);\n    },\n    defaultValue: post.md_draft || post.md,\n    tooltip: _Tooltip,\n    onChange: function onChange(change) {\n      var _change = change(),\n          html = _change.html,\n          markdown = _change.markdown;\n\n      if (markdown !== post.md) {\n        setPostAttribute({\n          html: html,\n          md: markdown\n        });\n      }\n    },\n    placeholder: \"Write a story..\" // ref={setRef}\n    ,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 11\n    }\n  }), __jsx(_JSXStyle, {\n    id: \"2767384027\",\n    __self: this,\n    __source: void 0\n  }, \".block-toolbar span span{display:block;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hYmhpL3d3dy9sZXR0ZXJwYWQtYWRtaW4vc3JjL3BhZ2VzL3Bvc3QvW3Bvc3RJZF0udHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXNONkIsQUFFaUIsY0FBQyIsImZpbGUiOiIvVXNlcnMvYWJoaS93d3cvbGV0dGVycGFkLWFkbWluL3NyYy9wYWdlcy9wb3N0L1twb3N0SWRdLnRzeCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIFBvc3REb2N1bWVudCxcbiAgUG9zdFF1ZXJ5LFxuICBQb3N0UXVlcnlWYXJpYWJsZXMsXG4gIElucHV0VXBkYXRlUG9zdCxcbn0gZnJvbSBcIkAvX19nZW5lcmF0ZWRfXy9xdWVyaWVzL3F1ZXJpZXMuZ3JhcGhxbFwiO1xuaW1wb3J0IHtcbiAgVXBkYXRlUG9zdERvY3VtZW50LFxuICBVcGRhdGVQb3N0TXV0YXRpb24sXG4gIFVwZGF0ZVBvc3RNdXRhdGlvblZhcmlhYmxlcyxcbn0gZnJvbSBcIkAvX19nZW5lcmF0ZWRfXy9xdWVyaWVzL211dGF0aW9ucy5ncmFwaHFsXCI7XG5pbXBvcnQgTGV0dGVycGFkRWRpdG9yIGZyb20gXCJsZXR0ZXJwYWQtZWRpdG9yXCI7XG5pbXBvcnQgeyBpbml0aWFsaXplQXBvbGxvIH0gZnJvbSBcIkAvZ3JhcGhxbC9hcG9sbG9cIjtcbmltcG9ydCB7IElucHV0LCBMYXlvdXQsIFBhZ2VIZWFkZXIsIFRhZywgVG9vbHRpcCB9IGZyb20gXCJhbnRkXCI7XG5pbXBvcnQgeyB1c2VSb3V0ZXIgfSBmcm9tIFwibmV4dC9yb3V0ZXJcIjtcbmltcG9ydCBBY3Rpb25zIGZyb20gXCJAL2NvbXBvbmVudHMvcG9zdC1tZXRhXCI7XG5pbXBvcnQge1xuICBJbWFnZSxcbiAgUG9zdFN0YXR1c09wdGlvbnMsXG4gIFBvc3RUeXBlcyxcbn0gZnJvbSBcIkAvX19nZW5lcmF0ZWRfXy90eXBlLWRlZnMuZ3JhcGhxbHNcIjtcbmltcG9ydCB7IHVzZUVmZmVjdCwgdXNlU3RhdGUgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IHVwbG9hZEZpbGUgfSBmcm9tIFwiLi4vLi4vLi4vc2hhcmVkL3VwbG9hZFwiO1xuaW1wb3J0IHsgcmVtb3ZlVHlwZW5hbWVzIH0gZnJvbSBcIi4uLy4uLy4uL3NoYXJlZC9yZW1vdmVUeXBlbmFtZXNcIjtcbmltcG9ydCB7IGRlYm91bmNlIH0gZnJvbSBcIi4uLy4uLy4uL3NoYXJlZC91dGlsc1wiO1xuaW1wb3J0IEZpbGVFeHBsb3JlciBmcm9tIFwiQC9jb21wb25lbnRzL2ZpbGUtZXhwbG9yZXJcIjtcbmltcG9ydCB3aXRoQXV0aENoZWNrIGZyb20gXCIuLi8uLi9ob2Mvd2l0aEF1dGhcIjtcbmltcG9ydCBFcnJvck1lc3NhZ2UgZnJvbSBcIkAvY29tcG9uZW50cy9FcnJvck1lc3NhZ2VcIjtcbmltcG9ydCBuZXh0Q29uZmlnIGZyb20gXCJuZXh0LmNvbmZpZ1wiO1xuaW1wb3J0IHsgTG9hZGluZ091dGxpbmVkIH0gZnJvbSBcIkBhbnQtZGVzaWduL2ljb25zXCI7XG5pbXBvcnQgSGVhZCBmcm9tIFwibmV4dC9oZWFkXCI7XG5cbmNvbnN0IHsgQ29udGVudCB9ID0gTGF5b3V0O1xuXG5leHBvcnQgZW51bSBNZWRpYVByb3ZpZGVyIHtcbiAgVW5zcGxhc2ggPSBcInVuc3BsYXNoXCIsXG4gIExldHRlcnBhZCA9IFwibGV0dGVycGFkXCIsXG59XG5cbmNvbnN0IHVwZGF0ZVBvc3RSZXF1ZXN0ID0gYXN5bmMgKFxuICBhdHRyczogT21pdDxJbnB1dFVwZGF0ZVBvc3QsIFwiaWRcIj4sXG4gIHBvc3RJZDogbnVtYmVyLFxuKSA9PiB7XG4gIGNvbnN0IGFwb2xsb0NsaWVudCA9IGF3YWl0IGluaXRpYWxpemVBcG9sbG8oKTtcbiAgcmV0dXJuIGFwb2xsb0NsaWVudC5tdXRhdGU8VXBkYXRlUG9zdE11dGF0aW9uLCBVcGRhdGVQb3N0TXV0YXRpb25WYXJpYWJsZXM+KHtcbiAgICBtdXRhdGlvbjogVXBkYXRlUG9zdERvY3VtZW50LFxuICAgIHZhcmlhYmxlczoge1xuICAgICAgZGF0YTogeyAuLi5yZW1vdmVUeXBlbmFtZXMoYXR0cnMpLCBpZDogcG9zdElkIH0sXG4gICAgfSxcbiAgfSk7XG59O1xuXG5jb25zdCBkZWJvdW5jZVVwZGF0ZVBvc3QgPSBkZWJvdW5jZSh1cGRhdGVQb3N0UmVxdWVzdCwgMTAwMCk7XG5cbmxldCBlZGl0b3I7XG5cbmZ1bmN0aW9uIFBvc3QoKSB7XG4gIGNvbnN0IHJvdXRlciA9IHVzZVJvdXRlcigpO1xuXG4gIGNvbnN0IFt1cGRhdGluZywgc2V0VXBkYXRpbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbcG9zdCwgc2V0UG9zdF0gPSB1c2VTdGF0ZTxQb3N0UXVlcnlbXCJwb3N0XCJdPigpO1xuICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlKFwiXCIpO1xuICBjb25zdCBbZmlsZUV4cGxvcmVyT3Blbiwgc2V0RmlsZUV4cGxvcmVyT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtwb3N0SGFzaCwgc2V0UG9zdEhhc2hdID0gdXNlU3RhdGUoXCJcIik7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCB7IHBvc3RJZCB9ID0gcm91dGVyLnF1ZXJ5O1xuICAgIGlmICghcG9zdElkKSByZXR1cm47XG4gICAgZ2V0UG9zdChwYXJzZUludChwb3N0SWQgYXMgc3RyaW5nKSkudGhlbihkYXRhID0+IHtcbiAgICAgIGlmIChkYXRhLl9fdHlwZW5hbWUgPT09IFwiUG9zdFwiKSB7XG4gICAgICAgIHNldFBvc3QoZGF0YSk7XG5cbiAgICAgICAgZmV0Y2gobmV4dENvbmZpZy5iYXNlUGF0aCArIFwiL2FwaS9nZXRQb3N0SGFzaD9pZD1cIiArIGRhdGEuaWQpXG4gICAgICAgICAgLnRoZW4ocmVzID0+IHJlcy50ZXh0KCkpXG4gICAgICAgICAgLnRoZW4oc2V0UG9zdEhhc2gpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZGF0YS5fX3R5cGVuYW1lID09PSBcIlBvc3RFcnJvclwiKSB7XG4gICAgICAgIHNldEVycm9yKGRhdGEubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sIFtyb3V0ZXJdKTtcblxuICBpZiAoIXBvc3QgfHwgcG9zdC5fX3R5cGVuYW1lICE9PSBcIlBvc3RcIikge1xuICAgIHJldHVybiA8RXJyb3JNZXNzYWdlIHRpdGxlPVwiRXJyb3JcIiBkZXNjcmlwdGlvbj17ZXJyb3J9IC8+O1xuICB9XG5cbiAgY29uc3QgdXBsb2FkSW1hZ2UgPSBhc3luYyAoZmlsZXM6IEZpbGVbXSkgPT4ge1xuICAgIGNvbnN0IHVwbG9hZGVkRmlsZXMgPSBhd2FpdCB1cGxvYWRGaWxlKHsgZmlsZXMsIHR5cGU6IFwicG9zdF9pbWFnZVwiIH0pO1xuICAgIHJldHVybiB1cGxvYWRlZEZpbGVzWzBdLnNyYztcbiAgfTtcblxuICBjb25zdCBzZXRQb3N0QXR0cmlidXRlID0gYXN5bmMgKGF0dHJzOiBPbWl0PElucHV0VXBkYXRlUG9zdCwgXCJpZFwiPikgPT4ge1xuICAgIC8vIGlmIHBvc3QgaXMgYWxyZWFkeSBwdWJsaXNoZWQgYW5kIG5ldyBjb250ZW50IGlzIGFkZGVkLCB0aGVuIHNhdmUgdGhpcyBhcyBkcmFmdFxuICAgIGlmIChwb3N0LnN0YXR1cyA9PT0gUG9zdFN0YXR1c09wdGlvbnMuUHVibGlzaGVkICYmIGF0dHJzLm1kKSB7XG4gICAgICBzZXRQb3N0KHsgLi4ucG9zdCwgbWRfZHJhZnQ6IGF0dHJzLm1kIH0pO1xuICAgIH1cbiAgICAvLyBpZiB0aGUgcG9zdCBpcyBwdWJsaXNoZWQgb3IgcmVwdWJsaXNoZWQsIHJlbW92ZSBkcmFmdFxuICAgIGVsc2UgaWYgKGF0dHJzLnN0YXR1cyA9PT0gUG9zdFN0YXR1c09wdGlvbnMuUHVibGlzaGVkKSB7XG4gICAgICBzZXRQb3N0KHsgLi4ucG9zdCwgLi4uYXR0cnMsIG1kX2RyYWZ0OiBcIlwiLCBtZDogcG9zdC5tZF9kcmFmdCB9KTtcbiAgICB9XG4gICAgLy8gc2F2ZSB0aGUgb3RoZXIgYXR0cmlidXRlcyBvZiBwb3N0XG4gICAgZWxzZSB7XG4gICAgICBzZXRQb3N0KHsgLi4ucG9zdCwgLi4uYXR0cnMgfSk7XG4gICAgfVxuICAgIHNldFVwZGF0aW5nKHRydWUpO1xuICAgIGF3YWl0IGRlYm91bmNlVXBkYXRlUG9zdChhdHRycywgcG9zdC5pZCk7XG4gICAgc2V0VXBkYXRpbmcoZmFsc2UpO1xuICB9O1xuXG4gIGNvbnN0IG9uTWVkaWFCcm93c2UgPSAoKSA9PiB7XG4gICAgc2V0RmlsZUV4cGxvcmVyT3Blbih0cnVlKTtcbiAgfTtcblxuICBjb25zdCBvbkZpbGVFeHBsb3JlckNsb3NlID0gKCkgPT4ge1xuICAgIHNldEZpbGVFeHBsb3Jlck9wZW4oZmFsc2UpO1xuICB9O1xuXG4gIGNvbnN0IGluc2VydEltYWdlVXJsSW5FZGl0b3IgPSBhc3luYyAoaW1hZ2VzOiB7XG4gICAgW3VybDogc3RyaW5nXTogSW1hZ2UgJiB7IGFsdDogc3RyaW5nIH07XG4gIH0pID0+IHtcbiAgICBjb25zdCB1cmxzID0gT2JqZWN0LmtleXMoaW1hZ2VzKTtcbiAgICBjb25zdCBpbnNlcnRQcm9taXNlcyA9IHVybHMubWFwKHVybCA9PiB7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGVkaXRvci5pbnNlcnRJbWFnZVVybCh1cmwsIGltYWdlc1t1cmxdLmFsdCB8fCBcIlwiKTtcbiAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGluc2VydFByb21pc2VzKTtcbiAgfTtcblxuICBjb25zdCB0YWdDb2xvciA9XG4gICAgcG9zdC5zdGF0dXMgPT09IFBvc3RTdGF0dXNPcHRpb25zLlB1Ymxpc2hlZCA/IFwiZ3JlZW5cIiA6IFwib3JhbmdlXCI7XG5cbiAgY29uc3QgaXNQb3N0ID0gcG9zdC50eXBlID09PSBQb3N0VHlwZXMuUG9zdDtcblxuICBjb25zdCBzZXRSZWYgPSBfZWRpdG9yID0+IHtcbiAgICBlZGl0b3IgPSBfZWRpdG9yO1xuICB9O1xuXG4gIHJldHVybiAoXG4gICAgPExheW91dCBzdHlsZT17eyBtaW5IZWlnaHQ6IFwiMTAwdmhcIiB9fT5cbiAgICAgIDxIZWFkPlxuICAgICAgICA8dGl0bGU+RWRpdGluZyAtIHtwb3N0LnRpdGxlfTwvdGl0bGU+XG4gICAgICA8L0hlYWQ+XG4gICAgICA8UGFnZUhlYWRlclxuICAgICAgICBjbGFzc05hbWU9XCJzaXRlLXBhZ2UtaGVhZGVyXCJcbiAgICAgICAgdGl0bGU9XCImbmJzcDtcIlxuICAgICAgICBzdHlsZT17eyBwYWRkaW5nOiAxMCB9fVxuICAgICAgICBvbkJhY2s9eygpID0+IHJvdXRlci5wdXNoKGlzUG9zdCA/IFwiL3Bvc3RzXCIgOiBcIi9wYWdlc1wiKX1cbiAgICAgICAgZXh0cmE9e1tcbiAgICAgICAgICA8TG9hZGluZ091dGxpbmVkIHNwaW4gaGlkZGVuPXshdXBkYXRpbmd9IGtleT1cInVwZGF0aW5nXCIgLz4sXG4gICAgICAgICAgPEFjdGlvbnNcbiAgICAgICAgICAgIGtleT1cImFjdGlvbnNcIlxuICAgICAgICAgICAgcG9zdD17cG9zdH1cbiAgICAgICAgICAgIHNldFBvc3RBdHRyaWJ1dGU9e3NldFBvc3RBdHRyaWJ1dGV9XG4gICAgICAgICAgICBwb3N0SGFzaD17cG9zdEhhc2h9XG4gICAgICAgICAgICBkZWxldGVQb3N0PXsoKSA9PiB7XG4gICAgICAgICAgICAgIHNldFBvc3RBdHRyaWJ1dGUoeyBzdGF0dXM6IFBvc3RTdGF0dXNPcHRpb25zLlRyYXNoZWQgfSk7XG4gICAgICAgICAgICAgIHJvdXRlci5wdXNoKGlzUG9zdCA/IFwiL3Bvc3RzXCIgOiBcIi9wYWdlc1wiKTtcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgLz4sXG4gICAgICAgIF19XG4gICAgICAgIHRhZ3M9ezxUYWcgY29sb3I9e3RhZ0NvbG9yfT57cG9zdC5zdGF0dXN9PC9UYWc+fVxuICAgICAgPjwvUGFnZUhlYWRlcj5cblxuICAgICAgPENvbnRlbnQgc3R5bGU9e3sgbWFyZ2luOiBcIjI0cHggMTZweCAwXCIgfX0+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzc05hbWU9XCJzaXRlLWxheW91dC1iYWNrZ3JvdW5kXCJcbiAgICAgICAgICBzdHlsZT17eyBtYXhXaWR0aDogNzYwLCBtYXJnaW46IFwiYXV0b1wiIH19XG4gICAgICAgID5cbiAgICAgICAgICA8SW5wdXQuVGV4dEFyZWFcbiAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgIHBhZGRpbmc6IDAsXG4gICAgICAgICAgICAgIGZvbnRTaXplOiAzOCxcbiAgICAgICAgICAgICAgbGluZUhlaWdodDogMSxcbiAgICAgICAgICAgICAgbWFyZ2luQm90dG9tOiA0MCxcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICB2YWx1ZT17cG9zdC50aXRsZX1cbiAgICAgICAgICAgIHJvd3M9ezJ9XG4gICAgICAgICAgICBhdXRvU2l6ZT17dHJ1ZX1cbiAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiRW50ZXIgYSB0aXRsZVwiXG4gICAgICAgICAgICBib3JkZXJlZD17ZmFsc2V9XG4gICAgICAgICAgICBvbkNoYW5nZT17ZSA9PiB7XG4gICAgICAgICAgICAgIHNldFBvc3RBdHRyaWJ1dGUoeyB0aXRsZTogZS50YXJnZXQudmFsdWUgfSk7XG4gICAgICAgICAgICB9fVxuICAgICAgICAgICAgb25LZXlQcmVzcz17ZSA9PiB7XG4gICAgICAgICAgICAgIGlmIChlLmtleSA9PT0gXCJFbnRlclwiKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGVkaXRvci5mb2N1cygpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9fVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPExldHRlcnBhZEVkaXRvclxuICAgICAgICAgICAgZGFyaz17bG9jYWxTdG9yYWdlLnRoZW1lID09PSBcImRhcmtcIn1cbiAgICAgICAgICAgIGdldEVkaXRvckluc3RhbmNlPXtzZXRSZWZ9XG4gICAgICAgICAgICBvbkltYWdlQnJvd3NlPXtvbk1lZGlhQnJvd3NlfVxuICAgICAgICAgICAgdXBsb2FkSW1hZ2U9eyhmaWxlOiBGaWxlKSA9PiB1cGxvYWRJbWFnZShbZmlsZV0pfVxuICAgICAgICAgICAgZGVmYXVsdFZhbHVlPXtwb3N0Lm1kX2RyYWZ0IHx8IHBvc3QubWR9XG4gICAgICAgICAgICB0b29sdGlwPXtfVG9vbHRpcH1cbiAgICAgICAgICAgIG9uQ2hhbmdlPXtjaGFuZ2UgPT4ge1xuICAgICAgICAgICAgICBjb25zdCB7IGh0bWwsIG1hcmtkb3duIH0gPSBjaGFuZ2UoKTtcbiAgICAgICAgICAgICAgaWYgKG1hcmtkb3duICE9PSBwb3N0Lm1kKSB7XG4gICAgICAgICAgICAgICAgc2V0UG9zdEF0dHJpYnV0ZSh7IGh0bWwsIG1kOiBtYXJrZG93biB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiV3JpdGUgYSBzdG9yeS4uXCJcbiAgICAgICAgICAgIC8vIHJlZj17c2V0UmVmfVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPHN0eWxlIGpzeCBnbG9iYWw+e2BcbiAgICAgICAgICAgIC5ibG9jay10b29sYmFyIHNwYW4gc3BhbiB7XG4gICAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIGB9PC9zdHlsZT5cbiAgICAgICAgICA8RmlsZUV4cGxvcmVyXG4gICAgICAgICAgICBtdWx0aT17dHJ1ZX1cbiAgICAgICAgICAgIGlzVmlzaWJsZT17ZmlsZUV4cGxvcmVyT3Blbn1cbiAgICAgICAgICAgIGhhbmRsZUNhbmNlbD17b25GaWxlRXhwbG9yZXJDbG9zZX1cbiAgICAgICAgICAgIG9uSW5zZXJ0PXtpbnNlcnRJbWFnZVVybEluRWRpdG9yfVxuICAgICAgICAgIC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9Db250ZW50PlxuICAgIDwvTGF5b3V0PlxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCB3aXRoQXV0aENoZWNrKFBvc3QpO1xuXG5hc3luYyBmdW5jdGlvbiBnZXRQb3N0KHBvc3RJZDogbnVtYmVyKSB7XG4gIGNvbnN0IGFwb2xsb0NsaWVudCA9IGF3YWl0IGluaXRpYWxpemVBcG9sbG8oKTtcbiAgY29uc3QgcG9zdCA9IGF3YWl0IGFwb2xsb0NsaWVudC5xdWVyeTxQb3N0UXVlcnksIFBvc3RRdWVyeVZhcmlhYmxlcz4oe1xuICAgIHF1ZXJ5OiBQb3N0RG9jdW1lbnQsXG4gICAgdmFyaWFibGVzOiB7XG4gICAgICBmaWx0ZXJzOiB7XG4gICAgICAgIGlkOiBwb3N0SWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuICByZXR1cm4gcG9zdC5kYXRhLnBvc3Q7XG59XG5cbmNvbnN0IF9Ub29sdGlwOiBSZWFjdC5GQzxhbnk+ID0gKHsgY2hpbGRyZW4sIHRvb2x0aXAgfSkgPT4ge1xuICByZXR1cm4gKFxuICAgIDxUb29sdGlwIHRpdGxlPXt0b29sdGlwfT5cbiAgICAgIDxzcGFuPntjaGlsZHJlbn08L3NwYW4+XG4gICAgPC9Ub29sdGlwPlxuICApO1xufTtcbiJdfQ== */\\n/*@ sourceURL=/Users/abhi/www/letterpad-admin/src/pages/post/[postId].tsx */\"), __jsx(FileExplorer, {\n    multi: true,\n    isVisible: fileExplorerOpen,\n    handleCancel: onFileExplorerClose,\n    onInsert: insertImageUrlInEditor,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 11\n    }\n  }))));\n}\n\n_s(Post, \"J4Z7BYy3ByhyuWod6815g+nDKZg=\", false, function () {\n  return [useRouter];\n});\n\n_c = Post;\nexport default _c2 = withAuthCheck(Post);\n\nfunction getPost(_x6) {\n  return _getPost.apply(this, arguments);\n}\n\nfunction _getPost() {\n  _getPost = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(postId) {\n    var apolloClient, post;\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.next = 2;\n            return initializeApollo();\n\n          case 2:\n            apolloClient = _context5.sent;\n            _context5.next = 5;\n            return apolloClient.query({\n              query: PostDocument,\n              variables: {\n                filters: {\n                  id: postId\n                }\n              }\n            });\n\n          case 5:\n            post = _context5.sent;\n            return _context5.abrupt(\"return\", post.data.post);\n\n          case 7:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n  return _getPost.apply(this, arguments);\n}\n\nvar _Tooltip = function _Tooltip(_ref5) {\n  var children = _ref5.children,\n      tooltip = _ref5.tooltip;\n  return __jsx(Tooltip, {\n    title: tooltip,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 5\n    }\n  }, __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }\n  }, children));\n};\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Post\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/abhi/www/letterpad-admin/src/pages/post/[postId].tsx"],"names":["PostDocument","UpdatePostDocument","LetterpadEditor","initializeApollo","Input","Layout","PageHeader","Tag","Tooltip","useRouter","Actions","PostStatusOptions","PostTypes","useEffect","useState","uploadFile","removeTypenames","debounce","FileExplorer","withAuthCheck","ErrorMessage","nextConfig","LoadingOutlined","Head","Content","MediaProvider","updatePostRequest","attrs","postId","apolloClient","mutate","mutation","variables","data","id","debounceUpdatePost","editor","Post","router","updating","setUpdating","post","setPost","error","setError","fileExplorerOpen","setFileExplorerOpen","postHash","setPostHash","query","getPost","parseInt","then","__typename","fetch","basePath","res","text","message","uploadImage","files","type","uploadedFiles","src","setPostAttribute","status","Published","md","md_draft","onMediaBrowse","onFileExplorerClose","insertImageUrlInEditor","images","urls","Object","keys","insertPromises","map","url","Promise","resolve","reject","insertImageUrl","alt","e","console","all","tagColor","isPost","setRef","_editor","minHeight","title","padding","push","Trashed","margin","maxWidth","fontSize","lineHeight","marginBottom","target","value","key","preventDefault","focus","localStorage","theme","file","_Tooltip","change","html","markdown","filters","children","tooltip"],"mappings":"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","sourcesContent":["import {\n  PostDocument,\n  PostQuery,\n  PostQueryVariables,\n  InputUpdatePost,\n} from \"@/__generated__/queries/queries.graphql\";\nimport {\n  UpdatePostDocument,\n  UpdatePostMutation,\n  UpdatePostMutationVariables,\n} from \"@/__generated__/queries/mutations.graphql\";\nimport LetterpadEditor from \"letterpad-editor\";\nimport { initializeApollo } from \"@/graphql/apollo\";\nimport { Input, Layout, PageHeader, Tag, Tooltip } from \"antd\";\nimport { useRouter } from \"next/router\";\nimport Actions from \"@/components/post-meta\";\nimport {\n  Image,\n  PostStatusOptions,\n  PostTypes,\n} from \"@/__generated__/type-defs.graphqls\";\nimport { useEffect, useState } from \"react\";\nimport { uploadFile } from \"../../../shared/upload\";\nimport { removeTypenames } from \"../../../shared/removeTypenames\";\nimport { debounce } from \"../../../shared/utils\";\nimport FileExplorer from \"@/components/file-explorer\";\nimport withAuthCheck from \"../../hoc/withAuth\";\nimport ErrorMessage from \"@/components/ErrorMessage\";\nimport nextConfig from \"next.config\";\nimport { LoadingOutlined } from \"@ant-design/icons\";\nimport Head from \"next/head\";\n\nconst { Content } = Layout;\n\nexport enum MediaProvider {\n  Unsplash = \"unsplash\",\n  Letterpad = \"letterpad\",\n}\n\nconst updatePostRequest = async (\n  attrs: Omit<InputUpdatePost, \"id\">,\n  postId: number,\n) => {\n  const apolloClient = await initializeApollo();\n  return apolloClient.mutate<UpdatePostMutation, UpdatePostMutationVariables>({\n    mutation: UpdatePostDocument,\n    variables: {\n      data: { ...removeTypenames(attrs), id: postId },\n    },\n  });\n};\n\nconst debounceUpdatePost = debounce(updatePostRequest, 1000);\n\nlet editor;\n\nfunction Post() {\n  const router = useRouter();\n\n  const [updating, setUpdating] = useState(false);\n  const [post, setPost] = useState<PostQuery[\"post\"]>();\n  const [error, setError] = useState(\"\");\n  const [fileExplorerOpen, setFileExplorerOpen] = useState(false);\n  const [postHash, setPostHash] = useState(\"\");\n\n  useEffect(() => {\n    const { postId } = router.query;\n    if (!postId) return;\n    getPost(parseInt(postId as string)).then(data => {\n      if (data.__typename === \"Post\") {\n        setPost(data);\n\n        fetch(nextConfig.basePath + \"/api/getPostHash?id=\" + data.id)\n          .then(res => res.text())\n          .then(setPostHash);\n      }\n\n      if (data.__typename === \"PostError\") {\n        setError(data.message);\n      }\n    });\n  }, [router]);\n\n  if (!post || post.__typename !== \"Post\") {\n    return <ErrorMessage title=\"Error\" description={error} />;\n  }\n\n  const uploadImage = async (files: File[]) => {\n    const uploadedFiles = await uploadFile({ files, type: \"post_image\" });\n    return uploadedFiles[0].src;\n  };\n\n  const setPostAttribute = async (attrs: Omit<InputUpdatePost, \"id\">) => {\n    // if post is already published and new content is added, then save this as draft\n    if (post.status === PostStatusOptions.Published && attrs.md) {\n      setPost({ ...post, md_draft: attrs.md });\n    }\n    // if the post is published or republished, remove draft\n    else if (attrs.status === PostStatusOptions.Published) {\n      setPost({ ...post, ...attrs, md_draft: \"\", md: post.md_draft });\n    }\n    // save the other attributes of post\n    else {\n      setPost({ ...post, ...attrs });\n    }\n    setUpdating(true);\n    await debounceUpdatePost(attrs, post.id);\n    setUpdating(false);\n  };\n\n  const onMediaBrowse = () => {\n    setFileExplorerOpen(true);\n  };\n\n  const onFileExplorerClose = () => {\n    setFileExplorerOpen(false);\n  };\n\n  const insertImageUrlInEditor = async (images: {\n    [url: string]: Image & { alt: string };\n  }) => {\n    const urls = Object.keys(images);\n    const insertPromises = urls.map(url => {\n      return new Promise((resolve, reject) => {\n        try {\n          editor.insertImageUrl(url, images[url].alt || \"\");\n          resolve(true);\n        } catch (e) {\n          reject();\n          console.error(e);\n        }\n      });\n    });\n    return Promise.all(insertPromises);\n  };\n\n  const tagColor =\n    post.status === PostStatusOptions.Published ? \"green\" : \"orange\";\n\n  const isPost = post.type === PostTypes.Post;\n\n  const setRef = _editor => {\n    editor = _editor;\n  };\n\n  return (\n    <Layout style={{ minHeight: \"100vh\" }}>\n      <Head>\n        <title>Editing - {post.title}</title>\n      </Head>\n      <PageHeader\n        className=\"site-page-header\"\n        title=\"&nbsp;\"\n        style={{ padding: 10 }}\n        onBack={() => router.push(isPost ? \"/posts\" : \"/pages\")}\n        extra={[\n          <LoadingOutlined spin hidden={!updating} key=\"updating\" />,\n          <Actions\n            key=\"actions\"\n            post={post}\n            setPostAttribute={setPostAttribute}\n            postHash={postHash}\n            deletePost={() => {\n              setPostAttribute({ status: PostStatusOptions.Trashed });\n              router.push(isPost ? \"/posts\" : \"/pages\");\n            }}\n          />,\n        ]}\n        tags={<Tag color={tagColor}>{post.status}</Tag>}\n      ></PageHeader>\n\n      <Content style={{ margin: \"24px 16px 0\" }}>\n        <div\n          className=\"site-layout-background\"\n          style={{ maxWidth: 760, margin: \"auto\" }}\n        >\n          <Input.TextArea\n            style={{\n              padding: 0,\n              fontSize: 38,\n              lineHeight: 1,\n              marginBottom: 40,\n            }}\n            value={post.title}\n            rows={2}\n            autoSize={true}\n            placeholder=\"Enter a title\"\n            bordered={false}\n            onChange={e => {\n              setPostAttribute({ title: e.target.value });\n            }}\n            onKeyPress={e => {\n              if (e.key === \"Enter\") {\n                e.preventDefault();\n                editor.focus();\n              }\n            }}\n          />\n          <LetterpadEditor\n            dark={localStorage.theme === \"dark\"}\n            getEditorInstance={setRef}\n            onImageBrowse={onMediaBrowse}\n            uploadImage={(file: File) => uploadImage([file])}\n            defaultValue={post.md_draft || post.md}\n            tooltip={_Tooltip}\n            onChange={change => {\n              const { html, markdown } = change();\n              if (markdown !== post.md) {\n                setPostAttribute({ html, md: markdown });\n              }\n            }}\n            placeholder=\"Write a story..\"\n            // ref={setRef}\n          />\n          <style jsx global>{`\n            .block-toolbar span span {\n              display: block;\n            }\n          `}</style>\n          <FileExplorer\n            multi={true}\n            isVisible={fileExplorerOpen}\n            handleCancel={onFileExplorerClose}\n            onInsert={insertImageUrlInEditor}\n          />\n        </div>\n      </Content>\n    </Layout>\n  );\n}\n\nexport default withAuthCheck(Post);\n\nasync function getPost(postId: number) {\n  const apolloClient = await initializeApollo();\n  const post = await apolloClient.query<PostQuery, PostQueryVariables>({\n    query: PostDocument,\n    variables: {\n      filters: {\n        id: postId,\n      },\n    },\n  });\n  return post.data.post;\n}\n\nconst _Tooltip: React.FC<any> = ({ children, tooltip }) => {\n  return (\n    <Tooltip title={tooltip}>\n      <span>{children}</span>\n    </Tooltip>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}